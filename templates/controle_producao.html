<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Controle de Produ√ß√£o - Plataforma de Gest√£o da Qualidade</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- √çcones do Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <!-- CSS Personalizado -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body class="pagina-controle-producao">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='imagens/logo-bonsono.png') }}" alt="Logo BonSono" width="40" height="40">
                Plataforma de Gest√£o da Qualidade
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('laudo_tecnico') }}">Laudo T√©cnico</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="{{ url_for('controle_producao') }}">Controle de Produ√ß√£o</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('lean_six_sigma') }}">Lean Six Sigma</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('analise_preditiva') }}">An√°lise Preditiva</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Conte√∫do Principal -->
    <div class="container-fluid main-content">
        <div class="row">
            <!-- Coluna Esquerda: Menu Lateral -->
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="section-title">
                            <i class="bi bi-menu-button-wide"></i> Opera√ß√µes
                        </h5>
                        <!-- Menu item for technical data sheet registration -->
                        <div class="menu-item" onclick="mostrarTela('fichaTecnica')">
                            <i class="bi bi-clipboard-data"></i>  Cadastro de Ficha T√©cnica
                        </div>
                        <div class="menu-item active" onclick="mostrarTela('cadastro')">
                            <i class="bi bi-file-earmark-text"></i> Cadastro de Produ√ß√£o
                        </div>
                        <div class="menu-item" onclick="mostrarTela('Produ√ß√µes')">
                            <i class="bi bi-box-seam"></i> Produ√ß√µes cadastradas
                        </div>
                        <div class="menu-item" onclick="mostrarTela('Componentes')">
                            <i class="bi bi-box-seam"></i> Componentes
                        </div>
                        <div class="menu-item " onclick="mostrarTela('estoque')">
                            <i class="bi bi-box-seam"></i> Estoque Atual
                        </div>
                        <!-- Hist√≥rico e Gr√°ficos - Link para Streamlit Cloud -->
                        <a class="menu-item text-decoration-none d-flex align-items-center"
                           href="https://dashboard-plataforma-err6cvzmsqkadji2bh7b75.streamlit.app/"
                           rel="noopener noreferrer"
                           target="_blank"
                           style="color: inherit; padding: 8px 12px; border-radius: 4px;"
                           onmouseover="this.style.backgroundColor='#f8f9'"
                           onmouseout="this.style.backgroundColor='transparent'">
                            <i class="bi bi-graph-up me-2"></i> Hist√≥rico e Gr√°ficos
                        </a>
                        <!-- F√≥rmulas Qu√≠micas - Link para tela interna -->
                        <div class="menu-item" onclick="mostrarTela('formulas')">
                            <i class="bi bi-journal-text"></i> F√≥rmulas Qu√≠micas
                        </div>
                        <hr class="my-4">
                        <h5 class="section-title">
                            <i class="bi bi-info-circle"></i> Informa√ß√µes T√©cnicas
                        </h5>
                        <p class="small text-muted">
                            O controle de produ√ß√£o √© fundamental para garantir qualidade, rastreabilidade e efici√™ncia nos processos de fabrica√ß√£o.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Coluna Direita: Conte√∫do Din√¢mico -->
            <div class="col-md-9">
                <!-- Tela: Cadastro de Bloco -->
                <div id="tela-cadastro" class="card">
                    <div class="card-body">
                        <h4 class="section-title">
                            <i class="bi bi-clipboard-check"></i> Cadastro de Bloco de Espuma
                        </h4>
                        <!-- ‚úÖ BLOCO DE MENSAGENS FLASH -->
                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
                            </div>
                            {% endfor %}
                        {% endif %}
                        {% endwith %}

                        <!-- FORMUL√ÅRIO DE CADASTRO DE PRODU√á√ÉO  - CORRIGIR FORMS DINAMICOS-->
                        <form id="formulario-bloco" method="POST" action="{{ url_for('cadastro_producao') }}">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="producao_id" class="form-label">N√∫mero do Bloco:</label>
                                    <input type="text" class="form-control" id="producao_id" name="producao_id" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="data_producao" class="form-label">Data:</label>
                                    <input type="date" class="form-control" id="data_producao" name="data_producao" value="{{ hoje }}">
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="tipo_espuma" class="form-label">Tipo de Espuma:</label>
                                    <select class="form-select" id="tipo_espuma" name="tipo_espuma" required>
                                        <option value="">Selecione o tipo</option>
                                        {% for tipo in tipos_espuma %}
                                            <option value="{{ tipo.id }}">{{ tipo.nome }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="cor" class="form-label">Cor:</label>
                                    <input type="text" class="form-control" id="cor" name="cor" required>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6 offset-md-3">
                                    <label for="altura" class="form-label">Altura do Bloco Quente (cm):</label>
                                    <input type="number" class="form-control" id="altura" name="altura" step="0.1" min="0" required>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Conformidade:</label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="conformidade" value="Conforme" checked>
                                            <label class="form-check-label">Conforme</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="conformidade" value="N√£o Conforme">
                                            <label class="form-check-label">N√£o Conforme</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="observacoes" class="form-label d-flex align-items-center">
                                    <i class="bi bi-pencil"></i> Observa√ß√µes:
                                </label>
                                <textarea class="form-control" id="observacoes" name="observacoes" rows="3"></textarea>
                            </div>
                            
                            <h5 class="section-title mt-4">
                                <i class="bi bi-flask"></i> Quantidade de Produtos Usados (em kg ou g)
                            </h5>
                            
                            <!-- container que ser√° preenchido dinamicamente -->
                            <div id="lista_componentes" class="row g-3">
                                <script>
                                document.addEventListener("DOMContentLoaded", function() {
                                    const selectTipo = document.getElementById("tipo_espuma");
                                    const listaComponentes = document.getElementById("lista_componentes");

                                    async function carregarComponentes(tipoId) {
                                        if (!tipoId) {
                                            listaComponentes.innerHTML = ""; // limpa se n√£o selecionar nada
                                            return;
                                        }

                                        try {
                                            const res = await fetch(`/componentes_por_tipo/${tipoId}`);
                                            if (!res.ok) throw new Error("Erro ao buscar componentes");
                                            const componentes = await res.json();

                                            // limpar
                                            listaComponentes.innerHTML = "";

                                            // gerar inputs ‚Äî colocamos value=0 por padr√£o
                                            componentes.forEach(c => {
                                                const html = `
                                                <div class="col-md-4 componente-item" data-componente-id="${c.id}">
                                                    <label for="componente_${c.id}" class="form-label">${c.nome} (kg ou g):</label>
                                                    <input type="number" class="form-control" id="componente_${c.id}" name="componente_${c.id}" step="0.01" min="0" value="0">
                                                </div>`;
                                                listaComponentes.insertAdjacentHTML('beforeend', html);
                                            });

                                        } catch (err) {
                                            console.error(err);
                                            // opcional: mostrar mensagem visual ao usu√°rio
                                        }
                                    }

                                    // carregar componentes se j√° existir um valor selecionado (edi√ß√£o/refresh)
                                    if (selectTipo && selectTipo.value) {
                                        carregarComponentes(selectTipo.value);
                                    }

                                    if (selectTipo) {
                                        selectTipo.addEventListener("change", function() {
                                            carregarComponentes(this.value);
                                        });
                                    }
                                });
                                </script>

                                <!-- JS vai injetar aqui os inputs do componente -->
                            </div>
                            <!-- üß† ASSISTENTE IA DE PRODU√á√ÉO --> 
                        <div class="card mt-4 border-info shadow-sm" id="ia-assistente">
                              <div class="card-header bg-info text-white d-flex align-items-center">
                                <i class="bi bi-cpu me-2"></i>
                                <strong>Assistente Inteligente de Produ√ß√£o</strong>
                            </div>
                            <div class="card-body">
                              <p class="text-muted mb-2">
                                  A IA analisa os dados preenchidos e compara com o hist√≥rico de produ√ß√£o.
                              </p>

                               <div id="ia-feedback" class="alert alert-secondary mb-0">
                                ‚è≥ Aguardando dados do preenchimento...
                               </div>
                            </div>
                        </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                                <button type="submit" class="btn btn-primary">
                                    Salvar e Gerar Laudo
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Tela: Estoque Atual -->
                <div id="tela-estoque" class="card d-none">
                    <div class="card-body">
                        <h4 class="section-title">
                            <i class="bi bi-box-seam"></i> Estoque Atual de Produtos Qu√≠micos
                        </h4>
                        <div class="mb-3">
                            <input type="text" class="form-control" id="search-estoque" placeholder="Buscar produto...">
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col">Produto Qu√≠mico</th>
                                        <th scope="col">Saldo Atual (kg)</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="estoque-tbody">
                                    {% for componente in todos_componentes %}
                                    {% set saldo = saldos.get(componente.id, 0) %}
                                    {% set status = 'Cr√≠tico' if saldo < 10 else 'Baixo estoque' if saldo < 50 else 'Normal' %}
                                    {% set badge_class = 'bg-danger' if saldo < 10 else 'bg-warning text-dark' if saldo < 50 else 'bg-success' %}
                                    <tr>
                                        <td>{{ componente.nome }}</td>
                                        <td>{{ "%.2f"|format(saldo)|replace('.', ',') }}</td>
                                        <td><span class="badge {{ badge_class }}">{{ status }}</span></td>
                                        <td>
                                            <a href="{{ url_for('ajustar_estoque', componente_id=componente.id) }}" class="btn btn-sm btn-warning me-1">Ajustar</a>
                                            <a href="{{ url_for('movimentacoes', componente_id=componente.id) }}" class="btn btn-sm btn-movimentacoes">Movimenta√ß√µes</a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tela: Produ√ß√µes Cadastradas Pedro passou aqui -->
                <div id="tela-Produ√ß√µes" class="card d-none">
                    <div class="card-body">
                        <h4 class="section-title mb-4">
                            <i class="bi bi-file-earmark-text"></i> Produ√ß√µes Cadastradas
                        </h4>

                        {% if producoes and producoes|length > 0 %}
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col">ID</th>
                                        <th scope="col">Bloco</th>
                                        <th scope="col">Data</th>
                                        <th scope="col">Tipo</th>
                                        <th scope="col">Cor</th>
                                        <th scope="col">Altura</th>
                                        <th scope="col">Conformidade</th>
                                        <th scope="col">Observa√ß√µes</th>
                                        <th scope="col" class="text-center">A√ß√µes</th>
                                        <th scope="col">Usu√°rio</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for producao in producoes %}
                                    <tr>
                                        <td>{{ producao.id }}</td>
                                        <td>{{ producao.producao_id }}</td>
                                        <td>{{ producao.data_producao.strftime('%d/%m/%Y') }}</td>
                                        <td>{{ producao.tipo_espuma }}</td>
                                        <td>{{ producao.cor }}</td>
                                        <td>{{ "%.1f"|format(producao.altura)|replace('.', ',') }}</td>
                                        <td>
                                            {% if producao.conformidade == 'Conforme' %}
                                                <span class="badge bg-success px-3 py-2">Conforme</span>
                                            {% else %}
                                                <span class="badge bg-danger px-3 py-2">N√£o Conforme</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ producao.observacoes or '-' }}</td>
                                        <td class="text-center">
                                            <a href="{{ url_for('ver_componentes_producao', producao_id=producao.id) }}"
                                            class="btn btn-outline-primary btn-sm" title="Ver Componentes" data-bs-toggle="tooltip">
                                                <i class="bi bi-eye"></i>  <!-- √çcone de "olho" para visualiza√ß√£o -->
                                            </a>
                                        </td>
                                        <td>{{ producao.usuario.nome }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="alert alert-secondary text-center mt-3" role="alert">
                            <i class="bi bi-info-circle"></i> Nenhuma produ√ß√£o cadastrada at√© o momento.
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div id="tela-Componentes" class="card d-none">
                    <div class="card-body">
                        <h4 class="section-title mb-4">
                        <i class="bi bi-tools"></i> Cadastro de Componentes
                        </h4>

                        <!-- Formul√°rio de Cadastro -->
                        <form method="POST" action="{{ url_for('cadastro_componente') }}">
                        <div class="row align-items-end">
                            <div class="col-md-9 mb-3">
                            <label for="nome" class="form-label">Nome do Componente:</label>
                            <input type="text" class="form-control" id="nome" name="nome" placeholder="Digite o nome do componente" required>
                            </div>
                            <div class="col-md-3 mb-3 text-end">
                            <button type="submit" class="btn btn-success w-100 mt-3">
                                <i class="bi bi-save"></i> Salvar
                            </button>
                            </div>
                        </div>
                        </form>

                        <!-- Mensagens Flash -->
                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
                            </div>
                            {% endfor %}
                        {% endif %}
                        {% endwith %}

                        <!-- Lista de Componentes -->
                        <div class="mt-4">
                        <h5 class="section-title">
                            <i class="bi bi-box-seam"></i> Componentes Cadastrados
                        </h5>

                        <div class="table-responsive mt-3">
                            <table class="table table-hover align-middle text-center">
                            <thead class="table-light">
                                <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Saldo Atual (kg)</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for componente in todos_componentes %}
                                <tr>
                                <td>{{ componente.id }}</td>
                                <td class="text-start">{{ componente.nome }}</td>
                                <td>{{ "%.2f"|format(saldos.get(componente.id, 0))|replace('.', ',') }}</td>
                                <td>
                                    {% if componente.ativo %}
                                    <a href="{{ url_for('toggle_componente', componente_id=componente.id) }}" 
                                        class="badge rounded-pill bg-success text-decoration-none px-3 py-2">
                                        Ativo
                                    </a>
                                    {% else %}
                                    <a href="{{ url_for('toggle_componente', componente_id=componente.id) }}" 
                                        class="badge rounded-pill bg-secondary text-decoration-none px-3 py-2">
                                        Inativo
                                    </a>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('movimentacoes', componente_id=componente.id) }}" 
                                    class="btn btn-sm btn-primary mb-1">
                                    <i class="bi bi-arrow-repeat"></i> Movimenta√ß√µes
                                    </a>
                                    
                                </td>
                                </tr>
                                {% else %}
                                <tr>
                                <td colspan="5" class="text-center text-muted">Nenhum componente cadastrado.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            </table>
                        </div>
                        </div>
                    </div>
                </div>

                <!-- üü¶ Bloco principal da Ficha T√©cnica -->
                <div id="tela-fichaTecnica" class="card d-none">
                    <div class="card-body">
                        <h4 class="section-title"><i class="bi bi-clipboard-data"></i> Ficha T√©cnica</h4>

                        <!-- Formul√°rio de cadastro -->
                        <div class="card shadow-sm">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <h4 class="mb-0"><i class="bi bi-clipboard-data"></i> Cadastro de Ficha T√©cnica</h4>
                                <a href="{{ url_for('index') }}" class="btn btn-light btn-sm">
                                    <i class="bi bi-arrow-left-circle"></i> Voltar
                                </a>
                            </div>
                        <div class="d-flex justify-content-end mb-3" style="margin-top: 15px; margin-right: 15px;">   

                            <a href="{{ url_for('cadastrar_tipo_espuma') }}" class="btn btn-outline-success">
                                <i class="bi bi-plus-circle"></i> Cadastrar Tipo de Espuma
                            </a>
                        </div>

                            <div class="card-body">
                                <form method="POST" action="{{ url_for('cadastrar_ficha_tecnica') }}">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="tipo_espuma" class="form-label fw-bold">Tipo de Espuma</label>
                                            <select class="form-select" id="tipo_espuma" name="tipo_espuma_id" required>
                                                <option value="">Selecione...</option>
                                                {% for tipo in tipos_espuma %}
                                                    <option value="{{ tipo.id }}" {% if request.form.get('tipo_espuma_id') == tipo.id|string %}selected{% endif %}>
                                                        {{ tipo.nome }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>

                                    <hr>

                                    <h5 class="fw-bold mb-3"><i class="bi bi-flask"></i> Componentes</h5>
                                    <div class="row">
                                        {% for componente in componentes %}
                                        <div class="col-md-4 mb-2">
                                            <div class="form-check">
                                                <input  class="form-check-input" type="checkbox"
                                                        id="componente_{{ componente.id }}"
                                                        name="componentes_ids"
                                                        value="{{ componente.id }}">
                                                <label class="form-check-label" for="componente_{{ componente.id }}">
                                                    {{ componente.nome }}
                                                </label>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>

                                    <div class="text-end mt-4">
                                        <button type="submit" class="btn btn-success">
                                            <i class="bi bi-save"></i> Salvar Ficha T√©cnica
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Mensagens Flash -->
                        <div class="mt-3">
                            {% with messages = get_flashed_messages(with_categories=true) %}
                                {% if messages %}
                                    {% for category, message in messages %}
                                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                            {{ message }}
                                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            {% endwith %}
                        </div>

                        <!-- üü¢ Lista de Fichas T√©cnicas -->
                        <div class="card mt-4 shadow-sm">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="bi bi-card-list"></i> Fichas T√©cnicas Cadastradas</h5>
                            </div>

                            <div class="card-body">
                                <p><strong>Total de fichas:</strong> {{ fichas|length }}</p>

                                {% if fichas %}
                                    <table class="table table-bordered table-striped align-middle">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 5%;">#</th>
                                                <th style="width: 20%;">Tipo de Espuma</th>
                                                <th style="width: 25%;">Descri√ß√£o</th>
                                                <th style="width: 35%;">Componentes</th>
                                                <th style="width: 15%;" class="text-center">A√ß√µes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for ficha in fichas %}
                                            <tr>
                                                <td>{{ ficha.id }}</td>
                                                <td>{{ ficha.tipo_espuma.nome }}</td>
                                                <td>{{ ficha.descricao or '-' }}</td>
                                                <td>
                                                    {% if ficha.componentes %}
                                                        {% for rel in ficha.componentes %}
                                                            {{ rel.componente.nome }}{% if not loop.last %}, {% endif %}
                                                        {% endfor %}
                                                    {% else %}
                                                        <span class="text-muted">Sem componentes</span>
                                                    {% endif %}
                                                </td>
                                                <td class="text-center">
                                                    <a href="{{ url_for('editar_ficha_tecnica', ficha_id=ficha.id) }}" 
                                                    class="btn btn-sm btn-warning">
                                                        <i class="bi bi-pencil-square"></i> Editar
                                                    </a>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}
                                    <p class="text-muted">Nenhuma ficha t√©cnica cadastrada ainda.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tela: Hist√≥rico e Gr√°ficos (placeholder - agora √© link externo) -->
                <div id="tela-historico" class="card d-none">
                    <div class="card-body">
                        <h4 class="section-title"><i class="bi bi-graph-up"></i> Hist√≥rico e Gr√°ficos</h4>
                        <p class="text-muted">Esta funcionalidade est√° dispon√≠vel em nosso dashboard externo. Clique no menu lateral para acessar.</p>
                    </div>
                </div>

                <!-- Tela: F√≥rmulas Qu√≠micas - Vers√£o completa -->
                <div id="tela-formulas" class="card d-none">
                    <div class="card-body">
                        <h4 class="section-title mb-4">
                            <i class="bi bi-journal-text"></i> F√≥rmulas Qu√≠micas - BonSono
                        </h4>
                        
                        <!-- Card principal com acesso ao Drive -->
                        <div class="card shadow-sm border-0 mb-4" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                            <div class="card-body p-4 text-center">
                                <div class="mb-3">
                                    <i class="bi bi-google display-1 text-danger"></i>
                                </div>
                                <h5 class="card-title fw-bold mb-2 text-primary">
                                    Reposit√≥rio Corporativo de F√≥rmulas
                                </h5>
                                <p class="card-text text-muted mb-4">
                                    Acesso centralizado a todas as f√≥rmulas qu√≠micas, propor√ß√µes e documenta√ß√£o t√©cnica da BonSono
                                </p>
                                <a href="https://drive.google.com/drive/u/1/folders/1Dzdbxy5PuWwfIsf0-UeBedWnzwhjPxnd"
                                   target="_blank"
                                   rel="noopener noreferrer"
                                   class="btn btn-danger btn-lg px-5 py-3 fw-bold shadow">
                                    <i class="bi bi-folder2-open me-2"></i> Acessar Google Drive
                                </a>
                                <div class="mt-3 text-muted small">
                                    <i class="bi bi-lock-fill"></i> Acesso restrito a colaboradores autorizados
                                </div>
                            </div>
                        </div>
                        
                        <!-- Documentos dispon√≠veis -->
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0 fw-bold"><i class="bi bi-file-earmark-text me-2"></i> Conte√∫do Dispon√≠vel</h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-check-circle-fill text-success mt-1 me-2"></i>
                                            <div>F√≥rmulas padr√£o (D23, D28, D33)</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-check-circle-fill text-success mt-1 me-2"></i>
                                            <div>F√≥rmulas especiais (Soft, HR, Memory)</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-check-circle-fill text-success mt-1 me-2"></i>
                                            <div>Tabelas de propor√ß√£o por densidade</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-check-circle-fill text-success mt-1 me-2"></i>
                                            <div>Manuais t√©cnicos e MSDS</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dica de seguran√ßa -->
                        <div class="alert alert-warning border-warning mb-4">
                            <div class="d-flex align-items-start">
                                <i class="bi bi-exclamation-triangle-fill text-warning me-2 mt-1"></i>
                                <div>
                                    <strong>Aten√ß√£o:</strong> Sempre utilize as vers√µes mais recentes das f√≥rmulas.
                                    Consulte o respons√°vel t√©cnico antes de qualquer altera√ß√£o nos par√¢metros de produ√ß√£o.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Instru√ß√µes de acesso -->
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0 fw-bold"><i class="bi bi-question-circle me-2"></i> Como Acessar</h6>
                            </div>
                            <div class="card-body">
                                <ol class="mb-0 ps-3">
                                    <li>Clique no bot√£o <strong>"Acessar Google Drive"</strong> acima</li>
                                    <li>Fa√ßa login com sua conta corporativa BonSono (@bonsomo.com.br)</li>
                                    <li>Navegue pelas pastas organizadas por tipo de espuma</li>
                                    <li>Para download: clique com bot√£o direito ‚Üí "Fazer download"</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Script principal - NAVEGA√á√ÉO ENTRE TELAS -->
<script>
// Navega√ß√£o entre telas
function mostrarTela(tela) {
    document.querySelectorAll('.col-md-9 > .card').forEach(el => el.classList.add('d-none'));
    const alvo = document.getElementById('tela-' + tela);
    if (alvo) alvo.classList.remove('d-none');
    document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
    if (event?.currentTarget) {
        event.currentTarget.classList.add('active');
    }
}

// Busca no estoque
document.getElementById('search-estoque')?.addEventListener('input', function() {
    const term = this.value.toLowerCase();
    const rows = document.querySelectorAll('#estoque-tbody tr');
    rows.forEach(row => {
        const nome = row.cells[0].textContent.toLowerCase();
        row.style.display = nome.includes(term) ? '' : 'none';
    });
});

// Tooltips (opcional)
document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
    new bootstrap.Tooltip(el, { placement: 'top' });
});

// IA Feedback
document.addEventListener("input", function () {
    const feedback = document.getElementById("ia-feedback");
    if (!feedback) return;
    const altura = parseFloat(document.getElementById("altura")?.value);
    const tipoEspuma = document.getElementById("tipo_espuma")?.value;
    if (!tipoEspuma || !altura) {
        feedback.className = "alert alert-secondary mb-0";
        feedback.innerHTML = "‚è≥ Aguardando dados do preenchimento...";
        return;
    }
    if (altura < 96) {
        feedback.className = "alert alert-warning mb-0";
        feedback.innerHTML = "‚ö†Ô∏è Altura abaixo do padr√£o hist√≥rico para este tipo de espuma. Pode indicar erro de dosagem.";
    }
    else if (altura > 120) {
        feedback.className = "alert alert-warning mb-0";
        feedback.innerHTML = "‚ö†Ô∏è Altura acima do padr√£o hist√≥rico para este tipo de espuma. Risco de varia√ß√£o de densidade.";
    }
    else {
        feedback.className = "alert alert-success mb-0";
        feedback.innerHTML = "‚úÖ Altura dentro da faixa hist√≥rica ideal para este tipo de espuma.";
    }
}
)
// ‚úÖ Script de inicializa√ß√£o - EXECUTA AP√ìS todas as fun√ß√µes estarem definidas
document.addEventListener('DOMContentLoaded', function() {
    // Verifica se estamos na p√°gina de controle de produ√ß√£o
    const isControleProducao = window.location.pathname.includes('/controle_producao');
    
    if (isControleProducao) {
        // Mostra a tela de cadastro
        mostrarTela('cadastro');
        
        // Marca o menu como ativo
        const cadastroMenu = document.querySelector('.menu-item[onclick*="mostrarTela(\'cadastro\')"]');
        if (cadastroMenu) {
            cadastroMenu.classList.add('active');
        }
    }
});
</script>
</body>
</html>